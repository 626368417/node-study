# Linuxï¼ˆäºŒï¼‰ç”¨æˆ·å’Œæ–‡ä»¶æƒé™

## 1.ç”¨æˆ·å’Œç”¨æˆ·ç»„

### ä¸€ã€ç”¨æˆ·ï¼ˆUserï¼‰

ä»€ä¹ˆæ˜¯`liunxç”¨æˆ·` :æœ¬è´¨å°±æ˜¯å¯ä»¥ç™»å½•ç³»ç»Ÿå¹¶ä½¿ç”¨ç³»ç»Ÿèµ„æºï¼ˆå¦‚è¿è¡Œç¨‹åºã€æ“ä½œæ–‡ä»¶ï¼‰çš„å®ä½“ã€‚ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„äººéƒ½æ˜¯ç”¨æˆ·ã€‚

**ä½œç”¨**

- **èº«ä»½æ ‡è¯†ï¼š** åŒºåˆ†ä¸åŒçš„ä½¿ç”¨è€…ï¼ˆå¦‚ `alice`, `bob`, `www-data`, `mysql`ï¼‰ã€‚
- **æƒé™æ§åˆ¶ï¼š** æ¯ä¸ªæ–‡ä»¶å’Œè¿›ç¨‹éƒ½æœ‰â€œæ‰€æœ‰è€…â€ã€‚æ–‡ä»¶çš„æ‰€æœ‰è€…å†³å®šäº†è°å¯ä»¥ä¿®æ”¹è¯¥æ–‡ä»¶çš„æƒé™æˆ–åˆ é™¤å®ƒã€‚è¿›ç¨‹çš„è¿è¡Œèº«ä»½å†³å®šäº†å®ƒèƒ½è®¿é—®å“ªäº›èµ„æºã€‚

- **èµ„æºéš”ç¦»ï¼š** ç¡®ä¿ä¸åŒç”¨æˆ·çš„æ•°æ®å’Œæ“ä½œç¯å¢ƒç›¸å¯¹ç‹¬ç«‹å’Œå®‰å…¨ã€‚

- **å®¡è®¡ï¼š** ç³»ç»Ÿæ—¥å¿—å¯ä»¥è®°å½•å“ªä¸ªç”¨æˆ·æ‰§è¡Œäº†ç‰¹å®šæ“ä½œã€‚

**ç±»å‹**

- **è¶…çº§ç”¨æˆ·ï¼ˆrootï¼‰**ï¼šUIDä¸º0ï¼Œæ‹¥æœ‰ç³»ç»Ÿçº§æœ€é«˜æƒé™ï¼Œå¯æ‰§è¡Œæ‰€æœ‰æ“ä½œï¼ˆå¦‚ä¿®æ”¹ç³»ç»Ÿé…ç½®ã€è®¿é—®ä»»æ„æ–‡ä»¶ï¼‰
- **ç³»ç»Ÿç”¨æˆ·ï¼ˆä¼ªç”¨æˆ·ï¼‰**ï¼šUIDèŒƒå›´é€šå¸¸ä¸º1-999ï¼ˆä¸åŒç³»ç»Ÿå¯èƒ½ç•¥æœ‰å·®å¼‚ï¼‰ï¼Œç”¨äºè¿è¡Œç³»ç»ŸæœåŠ¡ï¼ˆå¦‚`bin`ã€`daemon`ï¼‰ï¼Œé»˜è®¤æ— æ³•ç™»å½•
- **æ™®é€šç”¨æˆ·**ï¼šUIDâ‰¥1000ï¼Œç”±ç®¡ç†å‘˜åˆ›å»ºï¼Œæƒé™å—é™ï¼Œä»…èƒ½è®¿é—®æˆæƒèµ„æº

### äºŒã€ç”¨æˆ·ç»„ï¼ˆGroupï¼‰

ä»€ä¹ˆæ˜¯`Linux ç”¨æˆ·ç»„ `:ä¸€ç»„ç”¨æˆ·çš„é›†åˆã€‚å®ƒæ˜¯ä¸€ç§é€»è¾‘åˆ†ç»„æœºåˆ¶ï¼Œç”¨äºç®€åŒ–æƒé™ç®¡ç†ã€‚ç”¨æˆ·ç»„å°±æ˜¯æ˜¯å…·æœ‰ç›¸åŒç³»ç»Ÿæƒé™çš„ä¸€ç»„ç”¨æˆ·

**ä½œç”¨**

- **ç®€åŒ–æƒé™åˆ†é…**ï¼šç®€åŒ–æƒé™ç®¡ç†ï¼Œå…è®¸å°†ç›¸åŒæƒé™æ‰¹é‡åˆ†é…ç»™ç»„å†…æˆå‘˜ï¼Œè€Œéé€ä¸ªç”¨æˆ·è®¾ç½®ã€‚

**ç±»å‹**

- **åŸºæœ¬ç»„ï¼ˆç§æœ‰ç»„ï¼‰**ï¼šç”¨æˆ·åˆ›å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œä¸ç”¨æˆ·åç›¸åŒï¼Œæ¯ä¸ªç”¨æˆ·ä»…æœ‰ä¸€ä¸ªåŸºæœ¬ç»„ã€‚
- **é™„åŠ ç»„ï¼ˆå…¬æœ‰ç»„ï¼‰**ï¼šç”¨æˆ·å¯åŠ å…¥å¤šä¸ªé™„åŠ ç»„ï¼Œç»§æ‰¿ç»„å†…æƒé™ï¼ˆå¦‚`sudo`ç»„å…è®¸æ‰§è¡Œç®¡ç†å‘˜å‘½ä»¤ï¼‰

**ç”¨æˆ·ä¸ç»„çš„å…³ç³»ï¼š**

- **ä¸»ç»„ (Primary Group)ï¼š** æ¯ä¸ªç”¨æˆ·**å¿…é¡»**å±äºä¸€ä¸ªä¸»ç»„ã€‚ç”¨æˆ·åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶çš„â€œå±ç»„â€é»˜è®¤å°±æ˜¯ç”¨æˆ·çš„ä¸»ç»„ã€‚ç”¨æˆ·çš„ä¸»ç»„ä¿¡æ¯å­˜å‚¨åœ¨ `/etc/passwd` ä¸­ã€‚
- **é™„åŠ ç»„ (Supplementary Groups)ï¼š** ä¸€ä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶å±äº**é›¶ä¸ªæˆ–å¤šä¸ª**é™„åŠ ç»„ã€‚ç”¨æˆ·è·å¾—è¿™äº›é™„åŠ ç»„æ‰€æ‹¥æœ‰çš„æƒé™ã€‚é™„åŠ ç»„æˆå‘˜å…³ç³»å­˜å‚¨åœ¨ `/etc/group` æ–‡ä»¶ä¸­ã€‚
- **æ€»ç»“ï¼š** ç”¨æˆ·å’Œç»„çš„å…³ç³»æ˜¯**å¤šå¯¹å¤š**çš„ã€‚ä¸€ä¸ªç”¨æˆ·å¯ä»¥å±äºå¤šä¸ªç»„ï¼›ä¸€ä¸ªç»„å¯ä»¥åŒ…å«å¤šä¸ªç”¨æˆ·ã€‚

## 2 é…ç½®æ–‡ä»¶

### 2.1 `/etc/group` - ç”¨æˆ·ç»„ä¿¡æ¯åº“

```bash
# æŸ¥çœ‹ /etc/group
[root@lavm-zo7f3xq5c6 ~]# cat /etc/group
# group_name:password:GID:user_list
root:x:0:
bin:x:1:
daemon:x:2:
sys:x:3:
adm:x:4:
tty:x:5:
disk:x:6:
lp:x:7:
mem:x:8:
kmem:x:9:
wheel:x:10:
cdrom:x:11:
mail:x:12:postfix
man:x:15:
dialout:x:18:
floppy:x:19:
games:x:20:
tape:x:33:
video:x:39:
ftp:x:50:
lock:x:54:
audio:x:63:
nobody:x:99:
users:x:100:
utmp:x:22:
utempter:x:35:
input:x:999:
systemd-journal:x:190:
systemd-network:x:192:
dbus:x:81:
polkitd:x:998:
ssh_keys:x:997:
sshd:x:74:
postdrop:x:90:
postfix:x:89:
chrony:x:996:
jd:x:1000:jd
nscd:x:28:
ntp:x:38:
cgred:x:995:
docker:x:994:
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ         | è¯´æ˜                                                         |
| :----------- | :----------------------------------------------------------- |
| `group_name` | ç”¨æˆ·ç»„åç§°ï¼ˆå¦‚ `sudo`, `dev`ï¼‰                               |
| `password`   | **å†å²é—ç•™å­—æ®µ**ï¼ˆé€šå¸¸ä¸º `x` æˆ–ç©ºï¼‰ï¼ŒçœŸå®å¯†ç å­˜å‚¨åœ¨ `/etc/gshadow` |
| `GID`        | ç”¨æˆ·ç»„çš„å”¯ä¸€æ•°å­— IDï¼ˆç³»ç»Ÿç»„ï¼š1-999ï¼Œæ™®é€šç»„ï¼šâ‰¥1000ï¼‰          |
| `user_list`  | å±äºè¯¥ç»„çš„**é™„åŠ æˆå‘˜**åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼Œ**ä¸åŒ…å«ä»¥è¯¥ç»„ä¸ºä¸»ç»„çš„ç”¨æˆ·** |

- `root` ç»„ç¼–å·ä¸º `0`
- `1-499`ç³»ç»Ÿé¢„ç•™çš„ç¼–å· é¢„ç•™ç»™å®‰è£…çš„è½¯ä»¶å’ŒæœåŠ¡çš„

- ç”¨æˆ·æ‰‹åŠ¨åˆ›å»ºçš„ç”¨æˆ·ç»„ä»`500`å¼€å§‹

- ç»„å¯†ç å ä½ç¬¦éƒ½æ˜¯`x`
- å¦‚æœç»„å†…åªæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œè€Œä¸”ç”¨æˆ·åå’Œç»„åç›¸åŒçš„è¯ï¼Œæ˜¯å¯ä»¥çœç•¥ç”¨æˆ·åçš„

### 2.2 `/etc/gshadow` - ç”¨æˆ·ç»„åŠ å¯†ä¿¡æ¯

```bash
[root@lavm-zo7f3xq5c6 ~]# cat /etc/gshadow
# group_name:encrypted_password:admins:members
root:::
bin:::
daemon:::
sys:::
adm:::
tty:::
disk:::
lp:::
mem:::
kmem:::
wheel:::
cdrom:::
mail:::postfix
man:::
dialout:::
floppy:::
games:::
tape:::
video:::
ftp:::
lock:::
audio:::
nobody:::
users:::
utmp:!::
utempter:!::
input:!::
systemd-journal:!::
systemd-network:!::
dbus:!::
polkitd:!::
ssh_keys:!::
sshd:!::
postdrop:!::
postfix:!::
chrony:!::
jd:!!::jd
nscd:!::
ntp:!::
cgred:!::
docker:!::

```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ                 | è¯´æ˜                                                         |
| :------------------- | :----------------------------------------------------------- |
| `group_name`         | ç”¨æˆ·ç»„åç§°ï¼ˆä¸ `/etc/group` å¯¹åº”ï¼‰                           |
| `encrypted_password` | ç»„å¯†ç ï¼ˆåŠ å¯†åï¼‰ï¼Œç”¨äºéæˆå‘˜ç”¨æˆ·ä¸´æ—¶åŠ å…¥è¯¥ç»„ï¼ˆ`newgrp` å‘½ä»¤ï¼‰*ä¸ºç©º |
| `admins`             | ç»„ç®¡ç†å‘˜åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼Œå¯æ·»åŠ /åˆ é™¤ç»„æˆå‘˜                  |
| `members`            | ç»„æˆå‘˜åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ï¼Œ**è¦†ç›– `/etc/group` ä¸­çš„æˆå‘˜**       |

- å­˜æ”¾å½“å‰ç³»ç»Ÿä¸­ç”¨æˆ·ç»„çš„å¯†ç ä¿¡æ¯

- å’Œ`/etc/group`ä¸­çš„è®°å½•ä¸€ä¸€å¯¹åº”

### **2.3 `/etc/passwd` - ç”¨æˆ·è´¦æˆ·ä¿¡æ¯æ–‡ä»¶**

```bash
[root@lavm-zo7f3xq5c6 ~]# cat /etc/passwd
# username:password:UID:GID:GECOS:home_dir:shell
root:x:0:0:root:/root:/bin/bash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
games:x:12:100:games:/usr/games:/sbin/nologin
ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
nobody:x:99:99:Nobody:/:/sbin/nologin
systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin
dbus:x:81:81:System message bus:/:/sbin/nologin
polkitd:x:999:998:User for polkitd:/:/sbin/nologin
sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin
postfix:x:89:89::/var/spool/postfix:/sbin/nologin
chrony:x:998:996::/var/lib/chrony:/sbin/nologin
nscd:x:28:28:NSCD Daemon:/:/sbin/nologin
ntp:x:38:38::/etc/ntp:/sbin/nologin

```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ       | è¯´æ˜                                                         |
| :--------- | :----------------------------------------------------------- |
| `username` | ç”¨æˆ·ç™»å½•åï¼ˆå¦‚ `root`, `alice`ï¼‰                             |
| `password` | **å¯†ç å ä½ç¬¦**ï¼ˆ`x` è¡¨ç¤ºçœŸå®å¯†ç åœ¨ `/etc/shadow`ï¼‰           |
| `UID`      | ç”¨æˆ·å”¯ä¸€æ•°å­— IDï¼ˆ`0`=root, ç³»ç»Ÿç”¨æˆ·ï¼š1-999, æ™®é€šç”¨æˆ·ï¼šâ‰¥1000ï¼‰ |
| `GID`      | ç”¨æˆ·çš„**ä¸»ç»„ ID**ï¼ˆå¯¹åº” `/etc/group` ä¸­çš„ GIDï¼‰              |
| `GECOS`    | ç”¨æˆ·å¤‡æ³¨ä¿¡æ¯ï¼ˆå¦‚å…¨åã€ç”µè¯ï¼Œé€—å·åˆ†éš”ï¼‰                       |
| `home_dir` | ç”¨æˆ·ä¸»ç›®å½•è·¯å¾„ï¼ˆå¦‚ `/home/alice`ï¼‰                           |
| `shell`    | ç”¨æˆ·é»˜è®¤ Shellï¼ˆå¦‚ `/bin/bash`, `/usr/sbin/nologin`ï¼‰        |

- å­˜å‚¨å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„ä¿¡æ¯

### **2.4 `/etc/shadow` - ç”¨æˆ·å®‰å…¨ä¿¡æ¯æ–‡ä»¶**

```bash
 cat /etc/shadow
# username:encrypted_password:lastchg:min:max:warn:inactive:expire:reserved 
root:$6$KRlxyfFB$jw.j4L6boxyU3QulNeVOI4KycxRd0fQ2.NMBMP69/Lz1/Uk0MTJGuNi.HPpVbt1q1OjdvWdoZkCxjHBTIr7l10:20238:0:99999:7:::
bin:*:17834:0:99999:7:::
daemon:*:17834:0:99999:7:::
adm:*:17834:0:99999:7:::
lp:*:17834:0:99999:7:::
sync:*:17834:0:99999:7:::
shutdown:*:17834:0:99999:7:::
halt:*:17834:0:99999:7:::
mail:*:17834:0:99999:7:::
operator:*:17834:0:99999:7:::
games:*:17834:0:99999:7:::
ftp:*:17834:0:99999:7:::
nobody:*:17834:0:99999:7:::
systemd-network:!!:17942::::::
dbus:!!:17942::::::
polkitd:!!:17942::::::
sshd:!!:17942::::::
postfix:!!:17942::::::
chrony:!!:17942::::::
nscd:!!:17942::::::
ntp:!!:18058::::::

```

**å…³é”®å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ                 | è¯´æ˜                                                         |
| :------------------- | :----------------------------------------------------------- |
| `username`           | ç”¨æˆ·ç™»å½•åï¼ˆä¸ `/etc/passwd` å¯¹åº”ï¼‰                          |
| `encrypted_password` | **åŠ å¯†åçš„å¯†ç **ï¼ˆæ ¼å¼ï¼š`$id$salt$hash`ï¼Œå¦‚ `$6$abc...` è¡¨ç¤º SHA-512ï¼‰ |
| `lastchg`            | ä¸Šæ¬¡ä¿®æ”¹å¯†ç çš„å¤©æ•°ï¼ˆä» 1970-01-01 èµ·ï¼‰                       |
| `min`                | å¯†ç æœ€å°ä½¿ç”¨å¤©æ•°ï¼ˆ0=å¯éšæ—¶ä¿®æ”¹ï¼‰                             |
| `max`                | å¯†ç æœ€å¤§æœ‰æ•ˆæœŸï¼ˆ99999=æ°¸ä¸è¿‡æœŸï¼‰                             |
| `warn`               | å¯†ç åˆ°æœŸå‰è­¦å‘Šå¤©æ•°ï¼ˆ7=æå‰7å¤©è­¦å‘Šï¼‰                          |
| `inactive`           | å¯†ç è¿‡æœŸåè´¦æˆ·å®½é™å¤©æ•°ï¼ˆåˆ°æœŸåä»å¯ç™»å½•ï¼Œè¶…æ—¶åˆ™é”å®šï¼‰         |
| `expire`             | è´¦æˆ·ç»å¯¹è¿‡æœŸæ—¥æœŸï¼ˆä» 1970-01-01 èµ·çš„å¤©æ•°ï¼Œç©º=æ°¸ä¸è¿‡æœŸï¼‰      |

- å­˜æ”¾å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„å¯†ç ä¿¡æ¯

## 3. ç”¨æˆ·å‘½ä»¤

| å‘½ä»¤     | ä½œç”¨                   | å¸¸ç”¨å‚æ•°                 | ç¤ºä¾‹                             |
| :------- | :--------------------- | :----------------------- | :------------------------------- |
| `whoami` | æ˜¾ç¤ºå½“å‰ç”¨æˆ·å         | æ—                        | `whoami` â†’ `root`                |
| `id`     | æ˜¾ç¤ºç”¨æˆ·èº«ä»½ä¿¡æ¯       | `-u`(UID), `-g`(GID)     | `id alice` â†’ UID=1001, GID=1001  |
| `su`     | åˆ‡æ¢ç”¨æˆ·èº«ä»½           | `-` (åŠ è½½ç¯å¢ƒå˜é‡)       | `su - alice` â†’ åˆ‡æ¢åˆ°aliceç”¨æˆ·   |
| `sudo`   | ä»¥è¶…çº§ç”¨æˆ·æƒé™æ‰§è¡Œå‘½ä»¤ | `-i` (ç™»å½•shell)         | `sudo apt update` â†’ rootæƒé™æ›´æ–° |
| `passwd` | ä¿®æ”¹ç”¨æˆ·å¯†ç            | `-l` (é”å®š), `-u` (è§£é”) | `passwd alice` â†’ ä¿®æ”¹aliceçš„å¯†ç  |
| `groups` | æ˜¾ç¤ºç”¨æˆ·æ‰€å±ç»„         | æ—                        | `groups bob` â†’ `bob : sudo dev`  |
| `last`   | æ˜¾ç¤ºç”¨æˆ·ç™»å½•å†å²       | `-n` (è¡Œæ•°)              | `last alice` â†’ aliceçš„ç™»å½•è®°å½•   |

### 1. æ˜¾ç¤ºç™»å½•çš„ç”¨æˆ·å

```bash
[root@lavm-zo7f3xq5c6 ~]# whoami
root
```

### 2. æ˜¾ç¤ºç”¨æˆ·èº«ä»½ä¿¡æ¯

```bash
[root@lavm-zo7f3xq5c6 ~]# id root
uid=0(root) gid=0(root) ç»„=0(root)
```

### 3. **åˆ‡æ¢ç”¨æˆ·**

```bash
su - alice  # åˆ‡æ¢åˆ° alice ç”¨æˆ·å¹¶åŠ è½½å…¶ç¯å¢ƒ
Password:   # è¾“å…¥ alice çš„å¯†ç 
alice@host:~$ 
```

### 4. ä»¥è¶…çº§ç”¨æˆ·æƒé™æ‰§è¡Œå‘½ä»¤

```bash
# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
sudo tail -f /var/log/syslog
```

### 5. æ˜¾ç¤ºç”¨æˆ·æ‰€å±ç»„

```bash
[root@lavm-zo7f3xq5c6 ~]# groups root
root : root
```

### 6. æ˜¾ç¤ºç”¨æˆ·ç™»å½•å†å²

```bash
[root@lavm-zo7f3xq5c6 ~]# last
root     pts/1        173.41.142.189   Mon Jun  9 11:22   still logged in   
root     pts/0        173.41.143.189   Mon Jun  9 11:22   still logged in  
```

## 4. ç”¨æˆ·å’Œç”¨æˆ·ç»„æ“ä½œ

### 4.1 æ·»åŠ ç”¨æˆ·ç»„

```bash
# è¯­æ³•
groupadd [é€‰é¡¹] ç»„å
# é€‰é¡¹
#  -g GID: æŒ‡å®šç»„ID (é»˜è®¤è‡ªåŠ¨åˆ†é…)
# -r: åˆ›å»ºç³»ç»Ÿç»„ (GID < 1000)
#ç¤ºä¾‹
groupadd developers        # åˆ›å»ºæ™®é€šç»„
groupadd -g 1500 testers   # åˆ›å»ºæŒ‡å®šGIDçš„ç»„
groupadd -r apache         # åˆ›å»ºç³»ç»Ÿç»„

# ä½¿ç”¨
groupadd developers 
# æŸ¥çœ‹
[root@lavm-zo7f3xq5c6 ~]# cat /etc/group | grep developers
developers:x:1001:

```

### 4.2 ä¿®æ”¹ç”¨æˆ·ç»„åç§°

```bash
# è¯­æ³•
groupmod -n æ–°ç»„å æ—§ç»„å
# ç¤ºä¾‹
groupmod -n dev-team developers  # é‡å‘½åç»„
# æŸ¥çœ‹ 
[root@lavm-zo7f3xq5c6 ~]# cat /etc/group | grep dev-team
dev-team:x:1001:

```

### 4.3 ä¿®æ”¹ç”¨æˆ·ç»„ç¼–å·

```bash
# è¯­æ³•
groupmod -g æ–°GID ç»„å
# ç¤ºä¾‹
groupmod -g 2000 dev-team  # ä¿®æ”¹ç»„ID

# æŸ¥çœ‹
[root@lavm-zo7f3xq5c6 ~]# cat /etc/group | grep dev-team
dev-team:x:2000:

```



### 4.4 åˆ›å»ºåˆ†ç»„å¹¶æŒ‡å®šç¼–å·

```bash
# è¯­æ³•
groupadd -g æŒ‡å®šGID ç»„å

# ç¤ºä¾‹
groupadd -g 3000 qa-team  # åˆ›å»ºGID=3000çš„ç»„
# æŸ¥çœ‹
[root@lavm-zo7f3xq5c6 ~]# cat /etc/group | grep qa-team
qa-team:x:3000:

```



### 4.5 åˆ é™¤ç”¨æˆ·ç»„

```bash
# è¯­æ³•
groupdel ç»„å
# ä¸èƒ½åˆ é™¤ç”¨æˆ·çš„ä¸»ç»„
# ç¤ºä¾‹
groupdel qa-team  # åˆ é™¤ç»„
```



### 4.6 æ·»åŠ ç”¨æˆ· 

```bash
#è¯­æ³•
useradd [é€‰é¡¹] ç”¨æˆ·å
```

| é€‰é¡¹ | ä½œç”¨          | ç¤ºä¾‹å€¼          |
| :--- | :------------ | :-------------- |
| `-d` | æŒ‡å®šä¸»ç›®å½•    | `/home/alice`   |
| `-g` | æŒ‡å®šä¸»ç»„      | `developers`    |
| `-G` | æŒ‡å®šé™„åŠ ç»„    | `sudo,www-data` |
| `-s` | æŒ‡å®šç™»å½•Shell | `/bin/bash`     |
| `-u` | æŒ‡å®šUID       | `1500`          |
| `-m` | åˆ›å»ºä¸»ç›®å½•    | (æ— å‚æ•°å€¼)      |
| `-r` | åˆ›å»ºç³»ç»Ÿç”¨æˆ·  | (æ— å‚æ•°å€¼)      |

```bash
# ç¤ºä¾‹ 
useradd -g dev-team zhangsan  #åˆ›å»ºç”¨æˆ·å¹¶æŒ‡å®šç”¨æˆ·ç»„
# æŸ¥çœ‹
[root@lavm-zo7f3xq5c6 ~]# id zhangsan
uid=1000(zhangsan) gid=2000(dev-team) ç»„=2000(dev-team)

```



### 4.7 æŒ‡å®šä¸ªäººæ–‡ä»¶å¤¹

```bash
#è¯­æ³•
usermod -d æ–°ç›®å½• -m ç”¨æˆ·å  # -mç§»åŠ¨ç°æœ‰æ–‡ä»¶
  # åˆ›å»ºç”¨æˆ·å¹¶æŒ‡å®šå®¶ç›®å½•
useradd -d /home/wangwu wangwu 

# æŒ‡å®šwangwu2
usermod -d /home/wangwu2 wangwu
```



### 4.8 ä¿®æ”¹ç”¨æˆ·ç»„

```bash
#è¯­æ³•
usermod [é€‰é¡¹] ç”¨æˆ·å
```

| æ“ä½œ               | å‘½ä»¤æ ¼å¼                    |
| :----------------- | :-------------------------- |
| ä¿®æ”¹ä¸»ç»„           | `usermod -g æ–°ä¸»ç»„ ç”¨æˆ·å`  |
| **æ›¿æ¢**æ‰€æœ‰é™„åŠ ç»„ | `usermod -G ç»„1,ç»„2 ç”¨æˆ·å` |
| **è¿½åŠ **é™„åŠ ç»„     | `usermod -aG è¿½åŠ ç»„ ç”¨æˆ·å` |
| ä¿®æ”¹UID            | `usermod -u æ–°UID ç”¨æˆ·å`   |



```bash
usermod -g dev-team alice          # ä¿®æ”¹ä¸»ç»„
usermod -G docker,nginx alice      # æ›¿æ¢é™„åŠ ç»„
usermod -aG sudo alice             # è¿½åŠ sudoç»„
usermod -u 2001 alice              # ä¿®æ”¹UID
```



### 4.9 åˆ é™¤ç”¨æˆ·

```bash
# è¯­æ³•
userdel [é€‰é¡¹] ç”¨æˆ·å
# é€‰é¡¹
# -r: åŒæ—¶åˆ é™¤ä¸»ç›®å½•å’Œé‚®ä»¶
# -f: å¼ºåˆ¶åˆ é™¤ï¼ˆå³ä½¿å·²ç™»å½•ï¼‰
userdel -r alice  # å®Œå…¨åˆ é™¤ç”¨æˆ·åŠç›®å½•
```

## 5 .æ–‡ä»¶æƒé™



```bash
[root@lavm-zo7f3xq5c6 /]# ll
æ€»ç”¨é‡ 16
lrwxrwxrwx.   1 root root    7 2æœˆ  15 2019 bin -> usr/bin
dr-xr-xr-x.   5 root root 4096 5æœˆ  30 16:03 boot
drwxr-xr-x   19 root root 3000 5æœˆ  30 16:06 dev
drwxr-xr-x.  79 root root 8192 6æœˆ   9 16:17 etc
drwxr-xr-x.   5 root root   46 6æœˆ   9 15:31 home
-rw-------    1 root root 327059968 6æœˆ   1 14:06 net-tools-image.tar

# æƒé™ç»“æ„è§£æ
-rwxr-xr-- 1 user group 4096 Jan 1 10:00 file.txt
â†‘  â”¬ â”¬ â”¬   â†‘   â†‘    â†‘     â†‘      â†‘        â†‘
â”‚  â”‚ â”‚ â”‚   â”‚   â”‚    â”‚     â”‚      â”‚        â””â”€ æ–‡ä»¶å
â”‚  â”‚ â”‚ â”‚   â”‚   â”‚    â”‚     â”‚      â””â”€ ä¿®æ”¹æ—¶é—´
â”‚  â”‚ â”‚ â”‚   â”‚   â”‚    â”‚     â””â”€ æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
â”‚  â”‚ â”‚ â”‚   â”‚   â”‚    â””â”€ æ‰€å±ç»„
â”‚  â”‚ â”‚ â”‚   â”‚   â””â”€ æ‰€æœ‰è€…
â”‚  â”‚ â”‚ â”‚   â””â”€ é“¾æ¥æ•°
â”‚  â”‚ â”‚ â””â”€ å…¶ä»–äººæƒé™ (r--)
â”‚  â”‚ â””â”€ æ‰€å±ç»„æƒé™ (r-x)
â”‚  â””â”€ æ‰€æœ‰è€…æƒé™ (rwx)
â””â”€ æ–‡ä»¶ç±»å‹ï¼ˆ-ï¼šæ™®é€šæ–‡ä»¶ï¼Œdï¼šç›®å½•ï¼Œlï¼šé“¾æ¥ï¼‰
```



### 5.1 æ–‡ä»¶åŸºæœ¬æƒé™

- **æƒé™ç±»å‹**ï¼š
  - `r`ï¼ˆè¯»ï¼‰ï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹/åˆ—ç›®å½•æ¸…å•ï¼ˆå¯¹ç›®å½•ï¼‰
  - `w`ï¼ˆå†™ï¼‰ï¼šä¿®æ”¹æ–‡ä»¶å†…å®¹/åœ¨ç›®å½•å¢åˆ æ–‡ä»¶ï¼ˆå¯¹ç›®å½•ï¼‰
  - `x`ï¼ˆæ‰§è¡Œï¼‰ï¼šè¿è¡Œç¨‹åº/è¿›å…¥ç›®å½•ï¼ˆå¯¹ç›®å½•ï¼‰
- **æƒé™å½’å±**ï¼š
  - `å±ä¸»ï¼ˆuï¼‰`ï¼šæ–‡ä»¶æ‰€æœ‰è€…
  - `å±ç»„ï¼ˆgï¼‰`ï¼šæ–‡ä»¶æ‰€å±ç”¨æˆ·ç»„
  - `å…¶ä»–ç”¨æˆ·ï¼ˆoï¼‰`ï¼šæ—¢éå±ä¸»ä¹Ÿéå±ç»„æˆå‘˜çš„ç”¨æˆ·

```bash
ls -l æ–‡ä»¶å  # ç¤ºä¾‹ï¼š-rwxr-xr-- è¡¨ç¤ºå±ä¸»æœ‰rwxï¼Œå±ç»„æœ‰r-xï¼Œå…¶ä»–ç”¨æˆ·æœ‰r--
```



### 5.2 åŸºæœ¬æƒé™çš„ä¿®æ”¹

**ç¬¦å·æ¨¡å¼**ï¼š

```bash
#u :è¡¨ç¤ºå½“å‰ç”¨æˆ·
#gï¼šæ‰€å±ç»„
# Oï¼šå…¶ä»–ç”¨æˆ·
## æ‰€æœ‰ç”¨æˆ·ï¼ˆaï¼‰æ·»åŠ å†™æƒé™
chmod [ugoa][+-=][rwx] æ–‡ä»¶  
ç¤ºä¾‹ï¼š 
# u :è¡¨ç¤ºç”¨æˆ·
# + :æ·»åŠ 
# x:ï¼ˆæ‰§è¡Œï¼‰
chmod u+x data.txt       # ä¸ºæ‰€æœ‰è€…æ·»åŠ æ‰§è¡Œæƒé™  
# g :æ‰€å±ç»„
# - ï¼šåˆ é™¤
# wå†™
chmod g-w data.txt        # ç§»é™¤æ‰€å±ç»„çš„å†™æƒé™  
chmod a=rwx data.txt   # æ‰€æœ‰ç”¨æˆ·è®¾ä¸º rwx  
```

**æ•°å­—è¡¨ç¤ºæ³•**ï¼ˆå¸¸ç”¨ï¼‰ï¼š

```bash
# æƒé™æ•°æ®
# rï¼š4
# wï¼š2
#  xï¼š1


# 7= r+w+x
chmod 755 data1.txt       # rwxr-xr-x (7=rwx, 5=r-x)
chmod 644 data1.txt       # rw-r--r--
```

**é€’å½’ä¿®æ”¹**ï¼ˆç›®å½•åŠå†…å®¹ï¼‰ï¼š

```bash
chmod -R 755 ç›®å½•/
```



### 5.3 æƒé™çš„ä½œç”¨

#### **1 æ–‡ä»¶æƒé™**

| **æƒé™** |                           **å«ä¹‰**                           |   **ç¤ºä¾‹æ“ä½œ**    |
| :------: | :----------------------------------------------------------: | :---------------: |
|   `r`    | **è¯»å–æ–‡ä»¶å†…å®¹**ï¼šå…è®¸æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼ˆå¦‚ `cat`ã€`less`ã€`head`ã€`tail`ï¼‰ã€‚ | `cat example.txt` |
|   `w`    | **ä¿®æ”¹æ–‡ä»¶å†…å®¹**ï¼šå…è®¸ç¼–è¾‘æ–‡ä»¶å†…å®¹ï¼ˆéœ€é…åˆç›®å½•çš„ `w` æƒé™æ‰èƒ½åˆ é™¤æ–‡ä»¶ï¼‰ã€‚ | `vim example.txt` |
|   `x`    |      **æ‰§è¡Œæ–‡ä»¶**ï¼šå…è®¸è¿è¡Œæ–‡ä»¶ï¼ˆå¦‚è„šæœ¬ã€äºŒè¿›åˆ¶ç¨‹åºï¼‰ã€‚      |   `./script.sh`   |



**å…³é”®ç‚¹**ï¼š

- æ–‡ä»¶çš„ `w` æƒé™ä»…å…è®¸ä¿®æ”¹å†…å®¹ï¼Œ**åˆ é™¤æ–‡ä»¶éœ€ç›®å½•çš„ `w` æƒé™**ã€‚
- æ–‡ä»¶é»˜è®¤æƒé™ä¸º `644`ï¼ˆ`rw-r--r--`ï¼‰ï¼Œå³æ‰€æœ‰è€…å¯è¯»å†™ï¼Œå…¶ä»–ç”¨æˆ·åªè¯»ã€‚



#### **2 ç›®å½•æƒé™**

| **æƒé™** |                           **å«ä¹‰**                           |          **ç¤ºä¾‹æ“ä½œ**           |
| :------: | :----------------------------------------------------------: | :-----------------------------: |
|   `r`    |   **åˆ—å‡ºç›®å½•å†…å®¹**ï¼šå…è®¸æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆå¦‚ `ls`ï¼‰ã€‚    |         `ls /home/user`         |
|   `w`    | **ä¿®æ”¹ç›®å½•ç»“æ„**ï¼šå…è®¸åœ¨ç›®å½•ä¸­åˆ›å»ºã€åˆ é™¤ã€é‡å‘½åæ–‡ä»¶æˆ–å­ç›®å½•ã€‚ | `touch file.txt`ã€`rm file.txt` |
|   `x`    |   **è¿›å…¥ç›®å½•**ï¼šå…è®¸è®¿é—®ç›®å½•å†…çš„å…ƒæ•°æ®å’Œæ–‡ä»¶ï¼ˆå¦‚ `cd`ï¼‰ã€‚    |         `cd /home/user`         |

**å…³é”®ç‚¹**ï¼š

- ç›®å½•çš„ `w` æƒé™æ˜¯**æœ€å…³é”®çš„æ“ä½œæƒé™**ï¼Œå³ä½¿æ²¡æœ‰ `r` æƒé™ï¼Œåªè¦ç›®å½•æœ‰ `x` æƒé™ï¼Œç”¨æˆ·ä»å¯è¿›å…¥ç›®å½•å¹¶æ“ä½œæ–‡ä»¶ï¼ˆéœ€çŸ¥é“æ–‡ä»¶åï¼‰ã€‚
- ç›®å½•é»˜è®¤æƒé™ä¸º `755`ï¼ˆ`rwxr-xr-x`ï¼‰ï¼Œå³æ‰€æœ‰è€…å¯å®Œå…¨æ§åˆ¶ï¼Œå…¶ä»–ç”¨æˆ·å¯è¯»å’Œæ‰§è¡Œã€‚



#### 3. æ€»ç»“

**æƒé™ä¿®æ”¹å‘½ä»¤åŠæ•ˆæœ**

|         **å‘½ä»¤**         |                         **æƒé™è§£æ**                         |             **ç»“æœ**             |
| :----------------------: | :----------------------------------------------------------: | :------------------------------: |
|    `chmod 750 folder`    | `7 (rwx)` æ‰€æœ‰è€…, `5 (r-x)` ç»„, `0 (---)` å…¶ä»– â†’ **ä»…æ‰€æœ‰è€…å¯å®Œå…¨æ§åˆ¶ç›®å½•** |      ç›®å½•æƒé™ï¼š`drwxr-x---`      |
| `chmod 640 folder/1.txt` | `6 (rw-)` æ‰€æœ‰è€…, `4 (r--)` ç»„, `0 (---)` å…¶ä»– â†’ **æ‰€æœ‰è€…å¯è¯»å†™ï¼Œå…¶ä»–æ— æƒé™** |      æ–‡ä»¶æƒé™ï¼š`-rw-r-----`      |
|    `chmod 754 folder`    | `7 (rwx)` æ‰€æœ‰è€…, `5 (r-x)` ç»„, `4 (r--)` å…¶ä»– â†’ **æ‰€æœ‰è€…å¯å®Œå…¨æ§åˆ¶ï¼Œå…¶ä»–å¯è¯»** |      ç›®å½•æƒé™ï¼š`drwxr-xr--`      |
|    `chmod 755 folder`    | `7 (rwx)` æ‰€æœ‰è€…, `5 (r-x)` ç»„, `5 (r-x)` å…¶ä»– â†’ **å¼€æ”¾å…¬å…±è®¿é—®** |      ç›®å½•æƒé™ï¼š`drwxr-xr-x`      |
| `chmod 644 folder/1.txt` |                   åŒä¸Šï¼ˆæ¢å¤é»˜è®¤æ–‡ä»¶æƒé™ï¼‰                   |      æ–‡ä»¶æƒé™ï¼š`-rw-r--r--`      |
| `chmod 646 folder/1.txt` | `6 (rw-)` æ‰€æœ‰è€…, `4 (r--)` ç»„, `6 (rw-)` å…¶ä»– â†’ **å…¶ä»–ç”¨æˆ·å¯è¯»å†™æ–‡ä»¶** |      æ–‡ä»¶æƒé™ï¼š`-rw-rw-r--`      |
|    `chmod 757 folder`    | `7 (rwx)` æ‰€æœ‰è€…, `5 (r-x)` ç»„, `7 (rwx)` å…¶ä»– â†’ **è¿‡åº¦å¼€æ”¾æƒé™** | ç›®å½•æƒé™ï¼š`drwxr-xrwx`ï¼ˆä¸æ¨èï¼‰ |



- **æ–‡ä»¶æƒé™**ï¼š`rwx` æ§åˆ¶å†…å®¹è®¿é—®ï¼Œ`x` æ˜¯æ‰§è¡Œå…³é”®ã€‚
- **ç›®å½•æƒé™**ï¼š`rwx` æ§åˆ¶ç»“æ„æ“ä½œï¼Œ`x` æ˜¯è¿›å…¥ç›®å½•çš„å…³é”®ã€‚
- **å®‰å…¨åŸåˆ™**ï¼šéµå¾ªæœ€å°æƒé™åŸåˆ™ï¼Œé¿å…è¿‡åº¦å¼€æ”¾æƒé™ï¼ˆå¦‚ `777`ï¼‰ã€‚



## 6. é»˜è®¤æƒé™

#### **1 umaskï¼ˆæƒé™æ©ç ï¼‰**

**åŠŸèƒ½**ï¼šæ§åˆ¶æ–°åˆ›å»ºæ–‡ä»¶/ç›®å½•çš„é»˜è®¤æƒé™ï¼Œé€šè¿‡â€œå±è”½â€éƒ¨åˆ†æƒé™å®ç°ã€‚

```bash
#æŸ¥çœ‹å½“å‰ umask
umask  # è¾“å‡ºç¤ºä¾‹ï¼š0022
```

**ç»“æ„è§£æ**ï¼š

- ç¬¬ä¸€ä½ `0`ï¼šæ–‡ä»¶ç‰¹æ®Šæƒé™ï¼ˆSetUID/SetGID/Sticky Bitï¼‰
- åä¸‰ä½ `022`ï¼šæ–‡ä»¶/ç›®å½•çš„åŸºç¡€ umask å€¼

#### **2 æ–‡ä»¶é»˜è®¤æƒé™è§„åˆ™**

| è§„åˆ™                  | è¯´æ˜                                                     |
| :-------------------- | :------------------------------------------------------- |
| **æœ€å¤§æƒé™**          | `666`ï¼ˆrw-rw-rw-ï¼‰                                       |
| **ä¸å¯æ‰§è¡ŒåŸåˆ™**      | æ–°å»ºæ–‡ä»¶é»˜è®¤æ—  `x` æƒé™ï¼ˆå®‰å…¨æœºåˆ¶ï¼‰                      |
| **è®¡ç®—æ–¹å¼**          | `æ–‡ä»¶æƒé™ = 666 - umask`ï¼ˆéœ€**äºŒè¿›åˆ¶æŒ‰ä½å‡**ï¼Œéç®—æœ¯å‡ï¼‰ |
| **ç¤ºä¾‹**ï¼ˆumask=022ï¼‰ | `666 - 022 = 644` â†’ `rw-r--r--`ï¼ˆé744ï¼ï¼‰               |



#### **3 ç›®å½•é»˜è®¤æƒé™è§„åˆ™**

| è§„åˆ™                  | è¯´æ˜                            |
| :-------------------- | :------------------------------ |
| **æœ€å¤§æƒé™**          | `777`ï¼ˆrwxrwxrwxï¼‰              |
| **è®¡ç®—æ–¹å¼**          | `ç›®å½•æƒé™ = 777 - umask`        |
| **ç¤ºä¾‹**ï¼ˆumask=022ï¼‰ | `777 - 022 = 755` â†’ `rwxr-xr-x` |

> ğŸ“Œ **å…³é”®åŒºåˆ«**ï¼šç›®å½•ä¿ç•™æ‰§è¡Œæƒé™ï¼ˆ`x`ï¼‰ï¼Œç¡®ä¿å¯è¿›å…¥



#### **4 ä¿®æ”¹ umask å€¼**

- **ä¸´æ—¶ä¿®æ”¹**ï¼ˆä»…å½“å‰ä¼šè¯æœ‰æ•ˆï¼‰ï¼š

  ```bash
  umask 0002  # æ–°æ–‡ä»¶ï¼š664ï¼ˆrw-rw-r--ï¼‰ï¼Œç›®å½•ï¼š775ï¼ˆrwxrwxr-xï¼‰
  ```

- **æ°¸ä¹…ä¿®æ”¹**ï¼š

  ```bash
  vi /etc/profile  # åœ¨æœ«å°¾æ·»åŠ ï¼š umask 0002
  source /etc/profile  # ç«‹å³ç”Ÿæ•ˆ
  ```

## 7. sudoæƒé™

#### **æ ¸å¿ƒæ¦‚å¿µ**

> root æˆæƒæ™®é€šç”¨æˆ·æ‰§è¡Œç‰¹æƒå‘½ä»¤çš„å·¥å…·
>
> - æ“ä½œå¯¹è±¡ï¼šç³»ç»Ÿå‘½ä»¤ï¼ˆéœ€ç»å¯¹è·¯å¾„ï¼‰
> - é…ç½®æ–‡ä»¶ï¼š`/etc/sudoers`ï¼ˆå¿…é¡»ç”¨ `visudo` ç¼–è¾‘ï¼ï¼‰

#### **4.1 visudo é…ç½®è¯­æ³•**

```bash
# è¯­æ³•
ç”¨æˆ·å è¢«ç®¡ç†ä¸»æœº=(å¯åˆ‡æ¢èº«ä»½) æˆæƒå‘½ä»¤(ç»å¯¹è·¯å¾„)

# é…ç½®ç¤ºä¾‹
# 1. æˆæƒç”¨æˆ· stu2 ä»¥ root èº«ä»½æ‰§è¡Œæ‰€æœ‰å‘½ä»¤ï¼š
stu2    ALL=(root)    ALL
# 2. æˆæƒç»„ admin å…å¯†æ‰§è¡Œ apt æ›´æ–°ï¼š
%admin  ALL=(ALL)     NOPASSWD: /usr/bin/apt update

# 3. å…è®¸ç”¨æˆ· bob é‡å¯ç½‘ç»œæœåŠ¡ï¼š
bob     ALL=(root)    /usr/bin/systemctl restart network
```

**æƒé™ç”Ÿæ•ˆéªŒè¯**

```bash
# æ£€æŸ¥ sudo æƒé™
sudo -l  # æŸ¥çœ‹å½“å‰ç”¨æˆ·å¯æ‰§è¡Œçš„ sudo å‘½ä»¤

# æ‰§è¡Œç‰¹æƒå‘½ä»¤ï¼š
sudo /usr/bin/systemctl restart nginx  # éœ€è¾“å…¥ç”¨æˆ·å¯†ç ï¼ˆé™¤éé…ç½®NOPASSWDï¼‰
```

### **å®‰å…¨å®ˆåˆ™**

1. **umask æ¨èå€¼**ï¼š
   - æ™®é€šç”¨æˆ·ï¼š`0002`ï¼ˆæ–‡ä»¶664ï¼Œç›®å½•775ï¼‰
   - è¶…çº§ç”¨æˆ·ï¼š`0022`ï¼ˆæ–‡ä»¶644ï¼Œç›®å½•755ï¼‰
2. **sudo æœ€å°åŒ–æˆæƒ**ï¼š
   - ç¦æ­¢æ— é™åˆ¶ `ALL` æƒé™ï¼ˆå¦‚å¿…é¡»ï¼Œåˆ™ç”¨ `NOPASSWD:` éœ€è°¨æ…ï¼‰
   - å‘½ä»¤è·¯å¾„å¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼ˆé˜²æ­¢è·¯å¾„åŠ«æŒï¼‰

> é€šè¿‡ `visudo -c` å¯æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®